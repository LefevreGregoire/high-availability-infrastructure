## Mise en place de la VIP via Keepalived

### Script de vérification de service

Créez un script qui vérifiera si NGINX et le service PHP sont actifs :

```bash
sudo nano /usr/local/bin/check_nginx_service.sh
```

Contenu du script :

```bash
#!/bin/bash
# Script de vérification des services NGINX et PHP Frontend

# Vérifier si NGINX est actif
if ! systemctl is-active --quiet nginx; then
    exit 1
fi

# Vérifier si le service PHP frontend est actif
if ! systemctl is-active --quiet front-local.service; then
    exit 1
fi

# Vérifier si NGINX répond sur le port 80
if ! curl -sf http://localhost:80 > /dev/null 2>&1; then
    exit 1
fi

exit 0
```

Donnez les permissions d'exécution :

```bash
sudo chmod +x /usr/local/bin/check_nginx_service.sh
```

### Configuration de Keepalived sur NGINX01 (MASTER)

Éditez le fichier de configuration :

```bash
sudo nano /etc/keepalived/keepalived.conf
```

Configuration pour NGINX01 :

```bash
vrrp_script chk_nginx {
    script "/usr/local/bin/check_nginx_service.sh"
    interval 2
    timeout 2
    fall 2
    rise 2
}

vrrp_instance VI_NGINX {
    state MASTER
    interface enp0s3
    virtual_router_id 50
    priority 110
    advert_int 1

    authentication {
        auth_type PASS
        auth_pass nginx_ha
    }

    virtual_ipaddress {
        192.168.1.150/24
    }

    track_script {
        chk_nginx
    }
}
```
